<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>iOS项目结构进阶 | Teng's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">iOS项目结构进阶</h1><a id="logo" href="/.">Teng's Blog</a><p class="description">Try Everthing,</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">iOS项目结构进阶</h1><div class="post-meta">Dec 1, 2016<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span></div><div class="post-content"><p>从大二初学iOS开发，到现在也有两年了，断断续续做着一些iOS项目，从最开始的计算器，到后来的TAC的设备管理，再到课程项目，感觉在项目上的经验成熟了不少，至少在项目结构上已经不是杂乱无章，清晰的项目结构绝对是一个好项目的基础。</p>
<h2 id="初学iOS，不分模块，不分MVC"><a href="#初学iOS，不分模块，不分MVC" class="headerlink" title="初学iOS，不分模块，不分MVC"></a>初学iOS，不分模块，不分MVC</h2><p>还记得自己最开始学iOS开发时swift刚刚发布，一夜之间网络上到处都是从零开始iOS开发的课程，乘着这股风，我也走上了iOS开发的道路，在网上开始学习swift，学习使用Xcode，吭哧吭哧写了个计算器。一个storyboard和一个viewController搞定一切。</p>
<p>最简单的项目基本上就是把所有的运算和交互全部堆在一起调用，还好只是个计算器，只有加减乘除，不需要多少逻辑，整个controller也不过一百多行，只要命名好，看清楚代码逻辑还是不成问题的。</p>
<p>这样的项目结构缺点很明显，无法将逻辑代码和业务代码分开，如果这不是一个计算器，而是一个手机论坛app，所有的方法全部写在controller中的话显然是很不合理的，最终就会导致代码逻辑混乱，项目无法维护，于是我很快抛弃了这种最原始的项目结构。</p>
<h2 id="进阶，MVC，业务逻辑分离"><a href="#进阶，MVC，业务逻辑分离" class="headerlink" title="进阶，MVC，业务逻辑分离"></a>进阶，MVC，业务逻辑分离</h2><p>关于MVC，个人觉得斯坦福的公开课<a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/" target="_blank" rel="noopener">CS193</a>中老头讲的非常好，很适合经常拿出来看看，第一遍看的时候是一头雾水，完全听不懂老头在讲啥，不过紧接着老头就给出了一个很好的示范，也是一个计算器，但是要将model层的逻辑从controller中剥离出来。</p>
<p><img src="/images/2016-12-01-calculateDemo.png" alt="斯坦福老头的项目结构" height="300px"></p>
<p>在这里就可以看到老头的代码文件明显的做了MVC的区分，brain，也就是model只负责运算，这个代码结构显然比全部逻辑放在controller中好得多，尤其在日后维护和扩展上很容易就能找到各个部分，修起bug来也要方便很多。</p>
<p>第二个项目是苹果俱乐部的设备管理App，这是我在初学iOS时做的最大的一个项目，在这个项目中有五个人参与了App的开发，良好的MVC结构划分让多人协作也比较容易进行，不会出现大段的代码冲突，我只需要负责开发model层，而不会修改其他人的代码文件。</p>
<p><img src="/images/2016-12-01-deviceManager.png" alt="DM项目的MVC结构" height="600px"></p>
<h2 id="成熟，合理的模块划分，多人协作"><a href="#成熟，合理的模块划分，多人协作" class="headerlink" title="成熟，合理的模块划分，多人协作"></a>成熟，合理的模块划分，多人协作</h2><p>在之后的项目中基本上我一直在沿用MVC的结构，将项目按照MVC切分模块，最终的项目结构类似于下图⬇️</p>
<p><img src="/images/2016-12-01-wecitizens.png" alt="MVC模式下的项目结构" height="600px"></p>
<p>随着项目复杂度的上升，这几个项目都出现了几个非常严重的问题，Main.storyboard变得非常庞大，每次打开时都会花费很长时间，由于Xcode 7的不稳定，iOS开发变得非常艰难。如果项目是多人协作，几个人同时打开过storyboard并且做出修改，合并代码就会变成一场灾难。还有一个最大问题就是无法将controller和model再进行区分，一坨controller放在一起，很难找到view对应的controller是那个，如果命名不谨慎这又会是一场灾难，除非每个开发者对项目都非常熟悉，否则代码将会变得无法维护。【其实上面的DM差不多就是这样，由于我刚刚入坑时犯下的错误，这个项目的代码已经没人维护了。</p>
<p>开发过几个有比较复杂MVC结构的项目后，我感觉这种项目目录已经无法支撑更大的规模的开发，经过<a href="https://github.com/MandyXue/" target="_blank" rel="noopener">@薛哥</a>的指点，我们的项目演变成为按照Feature切分结构，将不同的Feature放在不同的Group中，每个Feature内部是一个MVC结构，将Main.storyboard根据Feature拆分，不同Feature页面之间的跳转用代码来完成。整体结构类似于下图，这个项目可以在<a href="https://github.com/MandyXue/Traveller" target="_blank" rel="noopener">这里</a>找到，不过swift版本是2.2，可能现在你已经无法将这个项目运行起来。</p>
<p><img src="/images/2016-12-01-traveller.png" alt="按照Feature切分Group的项目结构" height="700px"></p>
<p>这样的结构非常适合多人协作开发，不同的人只需要负责好自己的Feature，单独开发单独测试，最终只需要有一个人完成页面之间的逻辑即可，最大程度的减小了开发过程中造成代码合并冲突的可能。有一篇很好的blog也介绍了这种项目结构，同时非常详细地比较了Group和Folder的区别，你可以在<a href="http://www.samirchen.com/ios-project-structure/" target="_blank" rel="noopener">这里</a>找到。</p>
<p>在Traveller项目里有一个问题就是我没有将网络层代码做很好的封装，所有的网络请求都直接基于Alamofire库，由controller调用封装好的函数去请求数据，这会带来一个问题，很难对网络请求作出统一的过滤，比如设置request header和检查response，虽然我已经将函数封装，但这样的做法怎么看都不够优雅。</p>
<p>之后在IBM的实习我继续做iOS开发，在这里学到了不少经验。在新的项目中我们使用<a href="https://github.com/Moya/Moya" target="_blank" rel="noopener">Moya</a>封装网络层请求，使用<a href="https://github.com/Hearst-DD/ObjectMapper" target="_blank" rel="noopener">ObjectMapper</a>处理JSON数据，这样Model层的代码结构也变得非常清晰，并且可以很容易对网络请求做设置，这篇<a href="http://www.hmttommy.com/2015/12/15/Moya/" target="_blank" rel="noopener">blog</a>介绍了Moya的使用，通俗易懂。</p>
<p>有一个很好的开源项目例子就是wikipedia的iOS App，地址在<a href="https://github.com/wikimedia/wikipedia-ios" target="_blank" rel="noopener">这里</a>，有兴趣的话可以看看。</p>
<h2 id="传说级…还没有实践过"><a href="#传说级…还没有实践过" class="headerlink" title="传说级…还没有实践过"></a>传说级…还没有实践过</h2><p>之前看到过一篇blog，貌似是国内某大厂的iOS攻城狮所著，时间比较久了已经无法找到原文，他在文中提到了一种更成熟的做法，将不同的module分为不同的project，不同的module放到不同的git仓库，最后使用Cocoapods将所有module安装到同一个workspace，这样不仅做到了模块切分，在版本管理上也做到分离，如果App达到一定的规模我认为这是一个非常好的做法，不过由于现在还没有这样的需求，我还没有实践过，所以这里也不敢随意误导大家。</p>
</div><div class="tags"><a href="/tags/iOS/">iOS</a></div><div class="post-nav"><a class="pre" href="/2016/12/16/2016-12-16-英国留学中介问题/">英国留学中介问题</a><a class="next" href="/2016/11/19/2016-11-19-杂谈/">杂谈</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://teng.life"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/日常/">日常</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/旅行/" style="font-size: 15px;">旅行</a> <a href="/tags/杂谈/" style="font-size: 15px;">杂谈</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/攻略/" style="font-size: 15px;">攻略</a> <a href="/tags/Hadoop/" style="font-size: 15px;">Hadoop</a> <a href="/tags/留学/" style="font-size: 15px;">留学</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/01/23/2018-01-23-First-blog-in-English/">First blog in English</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/03/2015-06-06-程序员编程生涯中会犯的7个错误/">程序员编程生涯中会犯的7个错误</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/12/2017-04-12-Mac连接Windows在工作组里分享的打印机/">Mac连接Windows在工作组里分享的打印机</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/20/2016-12-20-英国留学信息及资源汇总/">英国留学信息及资源汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/16/2016-12-16-英国留学中介问题/">英国留学中介问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/01/2016-12-01-iOS项目结构进阶/">iOS项目结构进阶</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/19/2016-11-19-杂谈/">杂谈</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/30/2016-08-30-荷兰签证/">荷兰签证[2016年6月]</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/29/2016-08-29-俄罗斯签证指南/">俄罗斯签证指南[2016年6月]</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/29/2015-10-29-Hadoop学习笔记/">初学Hadoop之搭建简单集群</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Teng's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>